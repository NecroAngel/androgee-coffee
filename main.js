// Generated by CoffeeScript 2.0.2
(function() {
  var DiscordJs, WebRcon, debugChannel, discord, errorNotification, reoccuringErrors, rustChannel, wRcon;

  WebRcon = require("webrconjs");

  DiscordJs = require('discord.js');

  discord = new DiscordJs.Client();

  discord.login(process.env.PYGUY);

  debugChannel = "";

  rustChannel = "";

  reoccuringErrors = 0;

  discord.on("ready", function() {
    debugChannel = discord.channels.find("name", "debug");
    rustChannel = discord.channels.find("name", "rust-server");
    return wRcon();
  });

  // wRcon.run("say " + message, 0) if message.includes("has entered the game")
  // wRcon.run("env.time 9", 0) if message.includes("rust time")
  errorNotification = function(error) {
    if (reoccuringErrors > 10) {
      process.exit(1);
    }
    console.log(error);
    return debugChannel.send(error).then(reoccuringErrors++);
  };

  wRcon = function() {
    wRcon = new WebRcon(process.env.RUST_IP, 28016);
    wRcon.connect(process.env.RUST_PASSWORD);
    wRcon.on("connect", function() {
      return console.log("Connected!");
    });
    wRcon.on("disconnect", function() {
      return errorNotification("wRcon was disconnected");
    });
    wRcon.on("error", function(err) {
      return errorNotification(`wRcon ${err}`);
    });
    return wRcon.on("message", function(msg) {
      var playerJoin;
      if (msg.message.includes("has entered the game")) {
        playerJoin = msg.message.replace(/\[.*\]/, "");
        return rustChannel.fetchMessage(rustChannel.lastMessageID).then(function(message) {
          var rustJoin;
          if (playerJoin !== message.content) {
            rustChannel.send(playerJoin);
            rustJoin = playerJoin.replace("entered", "joined");
            return wRcon.run("say " + rustJoin, 0);
          }
        }).catch((function(error) {
          return errorNotification(error);
        }));
      } else {
        return console.log(msg.message);
      }
    });
  };

}).call(this);

//# sourceMappingURL=main.js.map
